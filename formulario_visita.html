<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Cruz Verde Visitas"><meta name="theme-color" content="#1a6e1a"><link rel="manifest" href="data:application/json,%7B%22name%22%3A%22Cruz%20Verde%20Visitas%22%2C%22short_name%22%3A%22Visitas%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23f4f8f4%22%2C%22theme_color%22%3A%22%231a6e1a%22%7D"><title>Cruz Verde ‚Äî Formulario de Visita a Locales</title><link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&display=swap" rel="stylesheet"><style>:root{--bg:#f4f8f4;--surface:#ffffff;--surface2:#e8f5e8;--border:#c2ddc2;--accent:#2e8b2e;--accent2:#1a6e1a;--text:#1c1a17;--text-muted:#7a7265;--danger:#c0392b;--warning:#d4a000;--ok:#145214;--ok-bg:#d4edda;--warn-bg:#fff8d6;--danger-bg:#fde8e8;--radius:12px;--shadow:0 2px 12px rgba(0,0,0,0.08)}*{box-sizing:border-box;margin:0;padding:0}body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh}header{background:linear-gradient(135deg,#1a6e1a 0%,#2e8b2e 100%);padding:0;position:sticky;top:0;z-index:100;box-shadow:0 2px 20px rgba(0,0,0,0.2)}.header-inner{max-width:960px;margin:0 auto;padding:18px 28px;display:flex;align-items:center;justify-content:space-between}.header-left{display:flex;align-items:center;gap:14px}.logo{background:var(--accent);width:42px;height:42px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:#fff;flex-shrink:0}.header-title{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;color:#fff}.header-sub{font-size:0.75rem;color:rgba(255,255,255,0.6);margin-top:1px}.btn-dashboard{background:#f5c800;border:1px solid #f5c800;border-radius:8px;color:#1a6e1a;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.82rem;font-weight:700;padding:8px 16px;text-decoration:none;display:flex;align-items:center;gap:6px;transition:background 0.2s}.btn-dashboard:hover{background:#e6b800}.progress-bar-wrap{background:var(--accent2);padding:0 28px 14px}.progress-bar-wrap-inner{max-width:960px;margin:0 auto}.step-labels{display:flex;gap:0;font-size:0.73rem;color:rgba(255,255,255,0.5);margin-bottom:8px}.step-label{flex:1;text-align:center;transition:color 0.3s}.step-label.done{color:rgba(255,255,255,0.9)}.progress-track{background:rgba(255,255,255,0.15);border-radius:4px;height:4px;overflow:hidden}.progress-fill{background:linear-gradient(90deg,#2e8b2e,#f5c800);height:100%;border-radius:4px;transition:width 0.4s cubic-bezier(.22,1,.36,1);width:20%}.form-wrap{max-width:960px;margin:32px auto 80px;padding:0 20px;display:flex;flex-direction:column;gap:24px}.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:var(--shadow);transition:box-shadow 0.2s}.card:focus-within{box-shadow:0 4px 24px rgba(200,57,10,0.12)}.card-header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid var(--border);background:var(--surface2)}.card-header-left{display:flex;align-items:center;gap:12px}.card-num{width:28px;height:28px;background:#1a6e1a;border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:0.78rem;font-weight:800;color:#fff}.card-title{font-family:'Syne',sans-serif;font-size:0.95rem;font-weight:700;color:var(--text)}.card-body{padding:24px;display:grid;gap:18px}.grid-2{grid-template-columns:1fr 1fr}.grid-3{grid-template-columns:1fr 1fr 1fr}.col-2{grid-column:span 2}.col-3{grid-column:span 3}.field{display:flex;flex-direction:column;gap:6px}label.lbl{font-size:0.75rem;font-weight:500;text-transform:uppercase;letter-spacing:0.7px;color:var(--text-muted)}label.lbl span{color:var(--accent)}input[type="text"],input[type="date"],input[type="time"],input[type="email"],select,textarea{background:var(--bg);border:1.5px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:0.92rem;padding:10px 13px;width:100%;transition:border-color 0.2s,box-shadow 0.2s;outline:none}input:focus,select:focus,textarea:focus{border-color:var(--accent2);box-shadow:0 0 0 3px rgba(26,58,92,0.1)}textarea{resize:vertical;min-height:80px;line-height:1.55}select{cursor:pointer}.op-tabs{display:flex;border-bottom:2px solid var(--border);gap:0;margin-bottom:0;background:var(--surface2);overflow-x:auto}.op-tab{background:none;border:none;border-bottom:3px solid transparent;color:var(--text-muted);cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.83rem;font-weight:500;padding:14px 20px;white-space:nowrap;margin-bottom:-2px;transition:color 0.2s,border-color 0.2s}.op-tab.active{color:#2e8b2e;border-bottom-color:#2e8b2e;font-weight:600}.op-tab:hover:not(.active){color:var(--text)}.tab-content{padding:24px}.tab-panel-op{display:none;flex-direction:column;gap:18px}.tab-panel-op.active{display:flex}.rating-group{display:flex;gap:8px;flex-wrap:wrap}.rating-opt{display:none}.rating-opt+label.rlbl{cursor:pointer;padding:7px 20px;border-radius:20px;font-size:0.82rem;font-weight:500;border:1.5px solid var(--border);color:var(--text-muted);background:var(--surface);transition:all 0.15s;user-select:none;letter-spacing:0;text-transform:none}.rating-opt[value="Alta"]:checked+label.rlbl,.rating-opt[value="Alta"]+label.rlbl:hover{background:var(--danger-bg);border-color:var(--danger);color:var(--danger);font-weight:600}.rating-opt[value="Media"]:checked+label.rlbl,.rating-opt[value="Media"]+label.rlbl:hover{background:var(--warn-bg);border-color:var(--warning);color:var(--warning);font-weight:600}.rating-opt[value="Baja"]:checked+label.rlbl,.rating-opt[value="Baja"]+label.rlbl:hover{background:var(--ok-bg);border-color:var(--ok);color:var(--ok);font-weight:600}.media-section{border-top:1px solid var(--border);padding:16px 24px;background:#fafaf7}.media-section-title{font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.7px;color:var(--text-muted);margin-bottom:12px;display:flex;align-items:center;gap:6px}.media-drop{border:2px dashed var(--border);border-radius:10px;padding:20px;text-align:center;cursor:pointer;transition:border-color 0.2s,background 0.2s;position:relative;background:var(--surface)}.media-drop:hover{border-color:var(--accent2);background:#f0f4f8}.media-drop input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}.media-drop .drop-icon{font-size:1.6rem;margin-bottom:6px}.media-drop p{font-size:0.82rem;color:var(--text-muted)}.media-drop strong{color:var(--text)}.preview-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}.prev-item{width:72px;height:72px;border-radius:8px;overflow:hidden;border:1.5px solid var(--border);position:relative;background:var(--surface2);flex-shrink:0}.prev-item img,.prev-item video{width:100%;height:100%;object-fit:cover}.prev-item .px{position:absolute;top:3px;right:3px;background:rgba(0,0,0,0.6);border:none;border-radius:50%;color:#fff;cursor:pointer;width:18px;height:18px;font-size:10px;display:flex;align-items:center;justify-content:center}.prev-item .px:hover{background:var(--danger)}.prev-item .file-type{display:flex;align-items:center;justify-content:center;height:100%;font-size:1.6rem}.incident-wrap{display:flex;flex-direction:column;gap:16px}.incident-item{border:1.5px solid var(--border);border-radius:12px;overflow:hidden;animation:popIn 0.2s ease}@keyframes popIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}.incident-head{background:var(--surface2);padding:10px 16px;display:flex;align-items:center;justify-content:space-between}.incident-badge{font-family:'Syne',sans-serif;font-size:0.72rem;font-weight:800;text-transform:uppercase;letter-spacing:0.5px;color:var(--accent2)}.btn-del-inc{background:none;border:1px solid rgba(200,57,10,0.3);border-radius:6px;color:var(--danger);cursor:pointer;font-size:0.73rem;padding:3px 10px;transition:background 0.2s}.btn-del-inc:hover{background:var(--danger-bg)}.incident-body{padding:18px;display:grid;grid-template-columns:1fr 1fr;gap:14px}.incident-body .c2{grid-column:span 2}.btn-add-inc{background:#f0f7ff;border:1.5px dashed #93c5fd;border-radius:10px;color:var(--accent2);cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.88rem;font-weight:500;padding:12px;text-align:center;transition:background 0.2s;width:100%}.btn-add-inc:hover{background:#dbeafe}.submit-area{display:flex;flex-direction:column;gap:12px;padding:0 4px}.btn-submit{background:var(--accent);border:none;border-radius:12px;color:#fff;cursor:pointer;font-family:'Syne',sans-serif;font-size:1.05rem;font-weight:800;padding:18px;width:100%;letter-spacing:0.3px;transition:opacity 0.2s,transform 0.15s;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 20px rgba(46,139,46,0.4)}.btn-submit:hover{opacity:0.9;transform:translateY(-1px)}.btn-submit:active{transform:translateY(0)}.btn-submit:disabled{opacity:0.5;cursor:not-allowed;transform:none}.submit-note{text-align:center;font-size:0.78rem;color:var(--text-muted)}.btn-secondary:hover{background:var(--border)}.toast{position:fixed;bottom:24px;right:24px;background:var(--accent2);color:#fff;font-family:'Syne',sans-serif;font-weight:700;font-size:0.88rem;padding:14px 22px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.2);transform:translateY(80px);opacity:0;transition:all 0.35s cubic-bezier(.22,1,.36,1);z-index:999;max-width:340px}.toast.show{transform:translateY(0);opacity:1}.toast.error{background:var(--danger)}@media (max-width:640px){.grid-2,.grid-3{grid-template-columns:1fr}.col-2,.col-3{grid-column:span 1}.incident-body{grid-template-columns:1fr}.incident-body .c2{grid-column:span 1}.card-body{padding:14px}.form-wrap{padding:0 10px;margin-top:16px;margin-bottom:100px}.header-inner{padding:10px 14px}.header-title{font-size:0.88rem !important}.header-sub{display:none}.btn-dashboard{font-size:0.75rem;padding:7px 10px}.progress-bar-wrap{padding:0 14px 10px}.step-labels{font-size:0.65rem}input[type="text"],input[type="date"],input[type="time"],input[type="email"],select,textarea{font-size:16px !important;padding:13px 14px;min-height:48px}textarea{min-height:80px}.op-tabs{overflow-x:auto;-webkit-overflow-scrolling:touch;flex-wrap:nowrap}.op-tab{padding:12px 16px;font-size:0.8rem;flex-shrink:0}.rating-opt+label.rlbl{padding:10px 18px;font-size:0.85rem;min-height:44px;display:inline-flex;align-items:center}.media-drop{padding:24px 16px}.media-drop .drop-icon{font-size:2rem}.prev-item{width:80px;height:80px}.btn-add-inc{padding:16px;font-size:0.92rem;min-height:52px}.btn-del-inc{padding:8px 14px;font-size:0.8rem;min-height:40px}.card-title{font-size:0.88rem}.card-header{padding:12px 14px}.media-section{padding:12px 14px}.submit-area{position:fixed;bottom:0;left:0;right:0;padding:12px 16px;background:#fff;border-top:2px solid var(--border);z-index:90;box-shadow:0 -4px 20px rgba(0,0,0,0.1)}.btn-submit{border-radius:10px;padding:16px;font-size:1rem}.submit-note{font-size:0.7rem;margin-top:4px}.toast{bottom:90px;right:12px;left:12px;text-align:center;max-width:none}.incident-badge{font-size:0.68rem}.incident-item{border-radius:10px}}*{-webkit-tap-highlight-color:transparent}button,a,select,input{touch-action:manipulation}</style></head><body><div style="background:#f5c800;height:5px;width:100%;position:sticky;top:0;z-index:101;"></div><header style="top:5px;"><div class="header-inner"><div class="header-left"><img src="data:image/jpeg;base64,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" alt="Cruz Verde" style="height:44px;width:auto;border-radius:6px;background:#fff;padding:2px;"><div><div class="header-title" style="font-size:1rem;">Visita a Locales ‚Äî Cruz Verde</div><div class="header-sub">Auditor√≠a Operativa de Locales</div></div></div><a href="dashboard.html" class="btn-dashboard">üìä Dashboard ‚Üí</a></div><div class="progress-bar-wrap"><div class="progress-bar-wrap-inner"><div class="step-labels"><span class="step-label done" id="sl1">Identificaci√≥n</span><span class="step-label" id="sl2">Operaciones</span><span class="step-label" id="sl3">Incidencias</span><span class="step-label" id="sl4">Cierre</span><span class="step-label" id="sl5">Enviar</span></div><div class="progress-track"><div class="progress-fill" id="progressFill"></div></div></div></div></header><div id="installBanner" style="display:none;background:#1a6e1a;color:#fff;padding:12px 16px;font-size:0.82rem;align-items:center;gap:10px;justify-content:space-between;position:sticky;top:0;z-index:200;"><span>üì± <strong>Tip:</strong> Agrega esta app a tu pantalla de inicio para acceso r√°pido</span><div style="display:flex;gap:8px;flex-shrink:0"><button onclick="showInstallHelp()" style="background:#f5c800;border:none;border-radius:6px;color:#1a6e1a;font-weight:700;font-size:0.78rem;padding:6px 12px;cursor:pointer;">¬øC√≥mo?</button><button onclick="dismissInstall()" style="background:rgba(255,255,255,0.2);border:none;border-radius:6px;color:#fff;font-size:0.78rem;padding:6px 10px;cursor:pointer;">‚úï</button></div></div><div id="installModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:500;align-items:flex-end;justify-content:center;padding:0;"><div style="background:#fff;border-radius:20px 20px 0 0;padding:24px 20px 40px;max-width:480px;width:100%;box-shadow:0 -8px 30px rgba(0,0,0,0.2);"><div style="width:40px;height:4px;background:#ddd;border-radius:2px;margin:0 auto 20px;"></div><h3 style="font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:800;color:#1a6e1a;margin-bottom:16px;">üì± Agregar a pantalla de inicio</h3><div id="installInstructions"></div><button onclick="closeInstallModal()" style="margin-top:20px;background:#1a6e1a;border:none;border-radius:10px;color:#fff;font-family:'Syne',sans-serif;font-weight:700;font-size:0.95rem;padding:14px;width:100%;cursor:pointer;">Entendido</button></div></div><form class="form-wrap" id="visitForm" onsubmit="submitForm(event)"><div class="card" data-section="1"><div class="card-header"><div class="card-header-left"><div class="card-num">1</div><span class="card-title">Identificaci√≥n del Local</span></div></div><div class="card-body grid-2"><div class="field"><label class="lbl">C√≥digo del Local <span>*</span></label><input type="text" id="f_codigo" placeholder="Ej. 1234" pattern="[0-9]+" inputmode="numeric" title="Solo n√∫meros" required></div><div class="field"><label class="lbl">Nombre del Local <span>*</span></label><input type="text" id="f_nombre" placeholder="Nombre completo" required></div><div class="field"><label class="lbl">Ciudad <span>*</span></label><input type="text" id="f_ciudad" placeholder="Ciudad" required></div><div class="field"><label class="lbl">L√≠der del Local <span>*</span></label><input type="text" id="f_lider" placeholder="Nombre del l√≠der" required></div><div class="field"><label class="lbl">Fecha de Visita <span>*</span></label><input type="date" id="f_fecha" required></div><div class="field"><label class="lbl">Hora de Visita</label><input type="time" id="f_hora"></div><div class="field col-2"><label class="lbl">Visitador / Auditor</label><input type="text" id="f_auditor" placeholder="Nombre del auditor" oninput="localStorage.setItem('vl_userName', this.value)"></div></div></div><div class="card" data-section="2"><div class="card-header"><div class="card-header-left"><div class="card-num">2</div><span class="card-title">Evaluaci√≥n de Operaciones</span></div></div><div class="op-tabs"><button type="button" class="op-tab active" onclick="opTab('sala',this)">üõç Sala de Venta</button><button type="button" class="op-tab" onclick="opTab('bodegas',this)">üì¶ Bodegas</button><button type="button" class="op-tab" onclick="opTab('comercial',this)">üìà Actividad Comercial</button><button type="button" class="op-tab" onclick="opTab('general',this)">üìã General</button></div><div class="tab-content"><div class="tab-panel-op active" id="tp-sala"><div class="grid-2" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;"><div class="field"><label class="lbl">Estado del piso de venta</label><select id="sala_piso"><option value="">‚Äî</option><option>Excelente</option><option>Bueno</option><option>Regular</option><option>Deficiente</option></select></div><div class="field"><label class="lbl">Orden y limpieza</label><select id="sala_limpieza"><option value="">‚Äî</option><option>Excelente</option><option>Bueno</option><option>Regular</option><option>Deficiente</option></select></div><div class="field"><label class="lbl">Exhibici√≥n de productos</label><select id="sala_exhibicion"><option value="">‚Äî</option><option>Excelente</option><option>Bueno</option><option>Regular</option><option>Deficiente</option></select></div><div class="field"><label class="lbl">Material POP / Se√±al√©tica</label><select id="sala_pop"><option value="">‚Äî</option><option>Correcto</option><option>Incompleto</option><option>Ausente</option></select></div><div class="field" style="grid-column:span 2"><label class="lbl">Observaciones</label><textarea id="sala_obs" placeholder="Describe el estado de la sala de venta..."></textarea></div></div></div><div class="tab-panel-op" id="tp-bodegas"><div class="grid-2" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;"><div class="field"><label class="lbl">Organizaci√≥n de bodega</label><select id="bod_org"><option value="">‚Äî</option><option>Excelente</option><option>Bueno</option><option>Regular</option><option>Deficiente</option></select></div><div class="field"><label class="lbl">Control de inventario</label><select id="bod_inv"><option value="">‚Äî</option><option>Al d√≠a</option><option>Con retrasos</option><option>Sin control</option></select></div><div class="field"><label class="lbl">Condiciones de almacenamiento</label><select id="bod_cond"><option value="">‚Äî</option><option>√ìptimas</option><option>Aceptables</option><option>Deficientes</option></select></div><div class="field"><label class="lbl">Seguridad / Acceso</label><select id="bod_seg"><option value="">‚Äî</option><option>Controlado</option><option>Parcial</option><option>Sin control</option></select></div><div class="field" style="grid-column:span 2"><label class="lbl">Observaciones</label><textarea id="bod_obs" placeholder="Describe el estado de bodegas..."></textarea></div></div></div><div class="tab-panel-op" id="tp-comercial"><div class="grid-2" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;"><div class="field"><label class="lbl">Cumplimiento de metas</label><select id="com_metas"><option value="">‚Äî</option><option>Superado (+100%)</option><option>En meta (90-100%)</option><option>Bajo meta (70-89%)</option><option>Muy bajo (-70%)</option></select></div><div class="field"><label class="lbl">Flujo de clientes</label><select id="com_flujo"><option value="">‚Äî</option><option>Alto</option><option>Normal</option><option>Bajo</option></select></div><div class="field"><label class="lbl">Calidad del servicio</label><select id="com_servicio"><option value="">‚Äî</option><option>Excelente</option><option>Bueno</option><option>Regular</option><option>Deficiente</option></select></div><div class="field"><label class="lbl">Estrategias activas</label><input type="text" id="com_estrategias" placeholder="Promociones, campa√±as..."></div><div class="field" style="grid-column:span 2"><label class="lbl">Observaciones</label><textarea id="com_obs" placeholder="Describe el desempe√±o comercial..."></textarea></div></div></div><div class="tab-panel-op" id="tp-general"><div class="grid-2" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;"><div class="field"><label class="lbl">Infraestructura</label><select id="gen_infra"><option value="">‚Äî</option><option>Excelente</option><option>Bueno</option><option>Regular</option><option>Requiere intervenci√≥n</option></select></div><div class="field"><label class="lbl">Dotaci√≥n de personal</label><select id="gen_personal"><option value="">‚Äî</option><option>Completa</option><option>Con ausencias</option><option>Incompleta</option></select></div><div class="field"><label class="lbl">Cumplimiento de protocolos</label><select id="gen_protocolos"><option value="">‚Äî</option><option>Total</option><option>Parcial</option><option>Incumplimiento</option></select></div><div class="field"><label class="lbl">Calificaci√≥n General</label><select id="gen_calificacion"><option value="">‚Äî</option><option>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelente</option><option>‚≠ê‚≠ê‚≠ê‚≠ê Muy Bueno</option><option>‚≠ê‚≠ê‚≠ê Bueno</option><option>‚≠ê‚≠ê Regular</option><option>‚≠ê Deficiente</option></select></div><div class="field" style="grid-column:span 2"><label class="lbl">Observaciones Generales</label><textarea id="gen_obs" placeholder="Resumen general de la visita..."></textarea></div></div></div></div><div class="media-section" id="mediaSalaSection"><div class="media-section-title">üì∑ Evidencia ‚Äî Sala de Venta</div><div class="media-drop" id="drop-sala"><input type="file" accept="image/*,video/*" capture="environment" multiple onchange="handleMedia(event,'sala')"><div class="drop-icon">üìÅ</div><p><strong>üì∑ Tomar foto / Adjuntar</strong></p><p style="font-size:0.75rem;margin-top:2px;">Sala de venta</p></div><div class="preview-row" id="prev-sala"></div></div><div class="media-section hidden" id="mediaBodySection" style="display:none"></div></div><div class="card" data-section="3"><div class="card-header"><div class="card-header-left"><div class="card-num">3</div><span class="card-title">Incidencias Encontradas</span></div></div><div class="card-body"><div class="incident-wrap" id="incidentWrap"></div><button type="button" class="btn-add-inc" onclick="addIncident()">Ôºã Agregar incidencia</button></div></div><div class="card" data-section="4"><div class="card-header"><div class="card-header-left"><div class="card-num">4</div><span class="card-title">Cierre de Visita</span></div></div><div class="card-body grid-2"><div class="field col-2"><label class="lbl">Compromisos pactados con el local</label><textarea id="f_compromisos" placeholder="Acuerdos y compromisos establecidos durante la visita..."></textarea></div><div class="field"><label class="lbl">Pr√≥xima visita programada</label><input type="date" id="f_proxima_visita"></div><div class="field"><label class="lbl">Visitador</label><input type="text" id="f_firma" placeholder="Nombre del visitador"></div></div></div><div class="submit-area" data-section="5"><button type="submit" class="btn-submit" id="btnSubmit"><span>üì§ Guardar Visita</span></button><p class="submit-note" id="submitNote">Los datos se guardar√°n en Google Sheets y quedar√°n visibles en el dashboard.</p></div></form><div class="toast" id="toast"></div><script>// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURACI√ìN ‚Äî El admin llena estos 2 valores una sola vez
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SHAREPOINT_SITE_URL = 'https://grupossocofar.sharepoint.com/sites/IndicadoresExpansi';
// Ej: https://grupossocofar.sharepoint.com/sites/IndicadoresExpansi
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.onload = () => {
document.getElementById('f_fecha').valueAsDate = new Date();
addIncident();
updateProgress();
setupMediaSections();
const saved = localStorage.getItem('vl_userName');
if (saved) document.getElementById('f_auditor').value = saved;
};
function updateProgress() {
const sections = document.querySelectorAll('[data-section]');
let filled = 0;
const f1 = document.getElementById('f_codigo').value && document.getElementById('f_nombre').value && document.getElementById('f_ciudad').value;
if (f1) filled = Math.max(filled, 1);
const f2 = document.getElementById('sala_piso').value || document.getElementById('gen_calificacion').value;
if (f2) filled = Math.max(filled, 2);
if (document.querySelectorAll('.incident-item').length > 0) filled = Math.max(filled, 3);
if (document.getElementById('f_compromisos').value) filled = Math.max(filled, 4);
const pct = (filled / 5) * 100;
document.getElementById('progressFill').style.width = Math.max(20, pct) + '%';
for (let i = 1; i <= 5; i++) {
const el = document.getElementById('sl' + i);
if (el) el.classList.toggle('done', i <= filled + 1);
}
}
document.addEventListener('input', updateProgress);
const tabMediaMap = {
sala: { label: 'üì∑ Evidencia ‚Äî Sala de Venta', hint: 'sala de venta' },
bodegas: { label: 'üì¶ Evidencia ‚Äî Bodegas', hint: 'bodegas' },
comercial: { label: 'üìà Evidencia ‚Äî Actividad Comercial', hint: 'actividad comercial' },
general: { label: 'üìã Evidencia ‚Äî General', hint: 'aspectos generales' }
};
function setupMediaSections() {
const container = document.getElementById('mediaBodySection').parentNode;
const afterCard = document.querySelector('.card[data-section="2"]');
}
let currentTab = 'sala';
const mediaSections = {};
function opTab(id, btn) {
document.querySelectorAll('.tab-panel-op').forEach(p => p.classList.remove('active'));
document.querySelectorAll('.op-tab').forEach(b => b.classList.remove('active'));
document.getElementById('tp-' + id).classList.add('active');
btn.classList.add('active');
currentTab = id;
renderMediaSection(id);
}
function renderMediaSection(id) {
const ms = document.getElementById('mediaSalaSection');
const cfg = tabMediaMap[id];
ms.querySelector('.media-section-title').textContent = cfg.label;
const oldDrop = ms.querySelector('.media-drop');
const oldPrev = ms.querySelector('.preview-row');
if (!mediaSections[id]) {
const drop = document.createElement('div');
drop.className = 'media-drop';
drop.id = 'drop-' + id;
drop.innerHTML = `<input type="file" accept="image/*,video/*" capture="environment" multiple><div class="drop-icon">üì∑</div><p><strong>Tomar foto / Adjuntar</strong></p><p style="font-size:0.75rem">${cfg.hint}</p>`;
drop.querySelector('input').addEventListener('change', e => handleMedia(e, id));
const prev = document.createElement('div');
prev.className = 'preview-row';
prev.id = 'prev-' + id;
mediaSections[id] = { drop, prev };
}
oldDrop.replaceWith(mediaSections[id].drop);
oldPrev.replaceWith(mediaSections[id].prev);
}
mediaSections['sala'] = {
drop: document.getElementById('drop-sala'),
prev: document.getElementById('prev-sala')
};
mediaSections['sala'].drop.querySelector('input').addEventListener('change', e => handleMedia(e, 'sala'));
const mediaStore = { sala: [], bodegas: [], comercial: [], general: [] };
function handleMedia(e, section) {
const files = Array.from(e.target.files);
const prevRow = document.getElementById('prev-' + section) || mediaSections[section]?.prev;
files.forEach(file => {
mediaStore[section].push(file);
const url = URL.createObjectURL(file);
const item = document.createElement('div');
item.className = 'prev-item';
if (file.type.startsWith('image/')) {
item.innerHTML = `<img src="${url}"><button type="button" class="px" onclick="removeMedia(this,'${url}','${section}')">‚úï</button>`;
} else if (file.type.startsWith('video/')) {
item.innerHTML = `<video src="${url}" muted></video><button type="button" class="px" onclick="removeMedia(this,'${url}','${section}')">‚úï</button>`;
} else {
item.innerHTML = `<div class="file-type">üìÑ</div><button type="button" class="px" onclick="removeMedia(this,'${url}','${section}')">‚úï</button>`;
}
prevRow.appendChild(item);
});
e.target.value = '';
}
function removeMedia(btn, url, section) {
URL.revokeObjectURL(url);
btn.parentElement.remove();
}
let incN = 0;
function addIncident() {
incN++;
const n = incN;
const div = document.createElement('div');
div.className = 'incident-item';
div.id = 'inc_' + n;
div.innerHTML = `
<div class="incident-head"><span class="incident-badge">‚ö† Incidencia #${n}</span><button type="button" class="btn-del-inc" onclick="delInc('inc_${n}')">‚úï Eliminar</button></div><div class="incident-body"><div class="field c2"><label class="lbl">Tipo de incidencia</label><select name="inc_tipo_${n}"><option value="">Seleccionar...</option><option>Operativa</option><option>Inventario</option><option>Infraestructura</option><option>Personal</option><option>Proveedor</option><option>Otro</option></select></div><div class="field c2"><label class="lbl">Descripci√≥n</label><textarea name="inc_desc_${n}" placeholder="Describe detalladamente la incidencia..." rows="2"></textarea></div><div class="field c2"><label class="lbl">Nivel de criticidad</label><div class="rating-group"><input class="rating-opt" type="radio" name="inc_crit_${n}" id="alta${n}" value="Alta"><label class="rlbl" for="alta${n}">üî¥ Alta</label><input class="rating-opt" type="radio" name="inc_crit_${n}" id="media${n}" value="Media"><label class="rlbl" for="media${n}">üü° Media</label><input class="rating-opt" type="radio" name="inc_crit_${n}" id="baja${n}" value="Baja"><label class="rlbl" for="baja${n}">üü¢ Baja</label></div></div><div class="field"><label class="lbl">Responsable asignado</label><input type="text" name="inc_resp_${n}" placeholder="Nombre del responsable"></div><div class="field"><label class="lbl">√Årea responsable</label><select name="inc_area_${n}"><option value="">‚Äî</option><option>Operaciones</option><option>Comercial</option><option>Log√≠stica</option><option>RRHH</option><option>TI</option><option>Gerencia</option></select></div><div class="field"><label class="lbl">üìÖ Fecha l√≠mite de seguimiento</label><input type="date" name="inc_fecha_${n}"></div><div class="field"><label class="lbl">Estado</label><select name="inc_estado_${n}"><option>Pendiente</option><option>En proceso</option><option>Resuelto</option></select></div></div>`;
document.getElementById('incidentWrap').appendChild(div);
}
function delInc(id) {
const el = document.getElementById(id);
el.style.opacity = '0'; el.style.transform = 'translateY(-6px)'; el.style.transition = 'all 0.2s';
setTimeout(() => el.remove(), 200);
}
function collectData() {
const form = document.getElementById('visitForm');
const incidents = [];
document.querySelectorAll('.incident-item').forEach((item, i) => {
const n = item.id.replace('inc_', '');
incidents.push({
tipo: form.querySelector(`[name="inc_tipo_${n}"]`)?.value || '',
descripcion: form.querySelector(`[name="inc_desc_${n}"]`)?.value || '',
criticidad: form.querySelector(`[name="inc_crit_${n}"]:checked`)?.value || '',
responsable: form.querySelector(`[name="inc_resp_${n}"]`)?.value || '',
area: form.querySelector(`[name="inc_area_${n}"]`)?.value || '',
fecha_seguimiento: form.querySelector(`[name="inc_fecha_${n}"]`)?.value || '',
estado: form.querySelector(`[name="inc_estado_${n}"]`)?.value || '',
});
});
return {
timestamp: new Date().toISOString(),
auditor: document.getElementById('f_auditor').value,
codigo: document.getElementById('f_codigo').value,
nombre: document.getElementById('f_nombre').value,
ciudad: document.getElementById('f_ciudad').value,
lider: document.getElementById('f_lider').value,
fecha_visita: document.getElementById('f_fecha').value,
hora_visita: document.getElementById('f_hora').value,
sala_piso: document.getElementById('sala_piso').value,
sala_limpieza: document.getElementById('sala_limpieza').value,
sala_exhibicion: document.getElementById('sala_exhibicion').value,
sala_pop: document.getElementById('sala_pop').value,
sala_obs: document.getElementById('sala_obs').value,
bod_org: document.getElementById('bod_org').value,
bod_inv: document.getElementById('bod_inv').value,
bod_cond: document.getElementById('bod_cond').value,
bod_seg: document.getElementById('bod_seg').value,
bod_obs: document.getElementById('bod_obs').value,
com_metas: document.getElementById('com_metas').value,
com_flujo: document.getElementById('com_flujo').value,
com_servicio: document.getElementById('com_servicio').value,
com_estrategias: document.getElementById('com_estrategias').value,
com_obs: document.getElementById('com_obs').value,
gen_infra: document.getElementById('gen_infra').value,
gen_personal: document.getElementById('gen_personal').value,
gen_protocolos: document.getElementById('gen_protocolos').value,
gen_calificacion: document.getElementById('gen_calificacion').value,
gen_obs: document.getElementById('gen_obs').value,
compromisos: document.getElementById('f_compromisos').value,
proxima_visita: document.getElementById('f_proxima_visita').value,
firma: document.getElementById('f_firma').value,
incidencias: incidents,
num_incidencias: incidents.length,
incidencias_alta: incidents.filter(i => i.criticidad === 'Alta').length,
};
}
async function submitForm(e) {
e.preventDefault();
const data = collectData();
const btn = document.getElementById('btnSubmit');
data.id = Date.now().toString();
const visits = JSON.parse(localStorage.getItem('vl_visits') || '[]');
visits.push(data);
localStorage.setItem('vl_visits', JSON.stringify(visits));
btn.disabled = true;
btn.querySelector('span').textContent = '‚è≥ Guardando...';
try {
await gsSend({...data, type: 'visita'});
for (const inc of (data.incidencias || [])) {
await gsSend({
type: 'incidencia',
visita_id: data.id, codigo: data.codigo, nombre: data.nombre, ciudad: data.ciudad,
tipo: inc.tipo, descripcion: inc.descripcion, criticidad: inc.criticidad,
responsable: inc.responsable, area: inc.area,
fecha_seguimiento: inc.fecha_seguimiento, estado: inc.estado || 'Pendiente'
});
}
showToast('‚úÖ Visita guardada correctamente en Google Sheets');
resetForm();
} catch (err) {
console.error(err);
showToast('‚ö† ' + err.message, 'error');
btn.disabled = false;
btn.querySelector('span').textContent = 'üì§ Guardar Visita';
}
}
async function gsSend(payload) {
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwTDaRZIQLST72kYHEoQvwiHclL3L_lGDbzUZH3YGBwSjxP3l7fZw81CMABHlQBaR6K/exec';
const params = new URLSearchParams({data: JSON.stringify(payload)});
const r = await fetch(SCRIPT_URL + '?' + params);
if (!r.ok) throw new Error('Error al guardar (' + r.status + ')');
const json = await r.json();
if (json.status === 'error') throw new Error(json.message);
return json;
}
function resetForm() {
document.getElementById('visitForm').reset();
document.getElementById('incidentWrap').innerHTML = '';
incN = 0;
addIncident();
document.getElementById('f_fecha').valueAsDate = new Date();
Object.keys(mediaStore).forEach(k => { mediaStore[k] = []; });
Object.values(mediaSections).forEach(s => { if (s.prev) s.prev.innerHTML = ''; });
updateProgress();
setTimeout(() => { if (confirm('‚úÖ Visita guardada. ¬øVer el Dashboard?')) window.location.href = 'dashboard.html'; }, 800);
}
function showToast(msg, type = 'ok') {
const t = document.getElementById('toast');
t.textContent = msg;
t.className = 'toast show' + (type === 'error' ? ' error' : '');
setTimeout(() => t.classList.remove('show'), 3500);
}
function detectMobile() {
return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
}
function isIOS() { return /iPhone|iPad|iPod/i.test(navigator.userAgent); }
function isAndroid() { return /Android/i.test(navigator.userAgent); }
function isInStandaloneMode() {
return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
}
if (detectMobile() && !isInStandaloneMode() && !localStorage.getItem('vl_installDismissed')) {
document.getElementById('installBanner').style.display = 'flex';
}
function dismissInstall() {
document.getElementById('installBanner').style.display = 'none';
localStorage.setItem('vl_installDismissed', '1');
}
function showInstallHelp() {
const modal = document.getElementById('installModal');
const inst  = document.getElementById('installInstructions');
if (isIOS()) {
inst.innerHTML = `
<p style="font-size:0.88rem;color:#555;line-height:1.6;margin-bottom:12px;">En Safari (iPhone/iPad):</p><div style="display:flex;flex-direction:column;gap:10px;"><div style="display:flex;align-items:center;gap:12px;background:#f4f8f4;border-radius:10px;padding:12px;"><span style="font-size:1.4rem;">1Ô∏è‚É£</span><span style="font-size:0.85rem;color:#333;">Toca el bot√≥n <strong>Compartir</strong> (cuadro con flecha ‚Üë) en la barra inferior de Safari</span></div><div style="display:flex;align-items:center;gap:12px;background:#f4f8f4;border-radius:10px;padding:12px;"><span style="font-size:1.4rem;">2Ô∏è‚É£</span><span style="font-size:0.85rem;color:#333;">Despl√°zate y toca <strong>"Agregar a pantalla de inicio"</strong></span></div><div style="display:flex;align-items:center;gap:12px;background:#f4f8f4;border-radius:10px;padding:12px;"><span style="font-size:1.4rem;">3Ô∏è‚É£</span><span style="font-size:0.85rem;color:#333;">Toca <strong>Agregar</strong> ‚Äî aparecer√° el √≠cono de Cruz Verde en tu pantalla</span></div></div>`;
} else {
inst.innerHTML = `
<p style="font-size:0.88rem;color:#555;line-height:1.6;margin-bottom:12px;">En Chrome (Android):</p><div style="display:flex;flex-direction:column;gap:10px;"><div style="display:flex;align-items:center;gap:12px;background:#f4f8f4;border-radius:10px;padding:12px;"><span style="font-size:1.4rem;">1Ô∏è‚É£</span><span style="font-size:0.85rem;color:#333;">Toca los <strong>3 puntos ‚ãÆ</strong> arriba a la derecha de Chrome</span></div><div style="display:flex;align-items:center;gap:12px;background:#f4f8f4;border-radius:10px;padding:12px;"><span style="font-size:1.4rem;">2Ô∏è‚É£</span><span style="font-size:0.85rem;color:#333;">Toca <strong>"Agregar a pantalla de inicio"</strong></span></div><div style="display:flex;align-items:center;gap:12px;background:#f4f8f4;border-radius:10px;padding:12px;"><span style="font-size:1.4rem;">3Ô∏è‚É£</span><span style="font-size:0.85rem;color:#333;">Toca <strong>Agregar</strong> ‚Äî el formulario aparece como app en tu pantalla</span></div></div>`;
}
modal.style.display = 'flex';
}
function closeInstallModal() {
document.getElementById('installModal').style.display = 'none';
dismissInstall();
}</script><div style="text-align:center;padding:20px;font-size:0.75rem;color:#7a9a7a;border-top:1px solid #c2ddc2;margin-top:20px;">
  ¬© Cruz Verde ‚Äî Sistema de Auditor√≠a de Locales
</div></body></html>
